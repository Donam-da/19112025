<UserControl x:Class="namm.InterfaceSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:namm"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             FontFamily="Segoe UI" Loaded="UserControl_Loaded">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Cột trái: Các tùy chọn -->
        <!-- Viewbox sẽ tự động co giãn các điều khiển để vừa với cửa sổ, trong khi vẫn giữ nguyên tỷ lệ -->
        <Viewbox Grid.Column="0" Stretch="Uniform" Margin="20">
            <StackPanel Width="360">
                <TextBlock Text="THIẾT LẬP GIAO DIỆN ĐĂNG NHẬP" FontSize="20" FontWeight="Bold" Margin="0,0,0,20" TextWrapping="Wrap"/>

                <GroupBox Header="Tùy chỉnh chung" Padding="10" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Chọn màu cơ bản:" Margin="0,0,0,5" FontStyle="Italic"/>
                        <WrapPanel x:Name="appColorPalette"/>

                        <TextBlock Text="Độ sáng:" Margin="0,10,0,2"/>
                        <Slider x:Name="sliderAppLightness" Minimum="-0.5" Maximum="0.5" Value="0" TickFrequency="0.1" ValueChanged="AppColorAdjustment_Changed"/>

                        <TextBlock Text="Độ mờ (Alpha):" Margin="0,10,0,2"/>
                        <Slider x:Name="sliderAppAlpha" Minimum="0" Maximum="1" Value="1" TickFrequency="0.1" ValueChanged="AppColorAdjustment_Changed"/>

                        <!-- Xem trước màu và mã Hex -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Rectangle Grid.Column="0" x:Name="rectAppColorPreview" Width="50" Height="25" Stroke="Black" StrokeThickness="1" Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" x:Name="txtAppBackgroundColorHex" VerticalContentAlignment="Center" LostFocus="HexColor_LostFocus" KeyDown="HexColor_KeyDown"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Tùy chỉnh Panel Trái" Padding="10">
                    <StackPanel>
                        <TextBlock Text="Chọn màu cơ bản:" Margin="0,0,0,5" FontStyle="Italic"/>
                        <WrapPanel x:Name="loginPanelColorPalette"/>

                        <TextBlock Text="Độ sáng:" Margin="0,10,0,2"/>
                        <Slider x:Name="sliderLoginPanelLightness" Minimum="-0.5" Maximum="0.5" Value="0" TickFrequency="0.1" ValueChanged="LoginPanelColorAdjustment_Changed"/>

                        <TextBlock Text="Độ mờ (Alpha):" Margin="0,10,0,2"/>
                        <Slider x:Name="sliderLoginPanelAlpha" Minimum="0" Maximum="1" Value="1" TickFrequency="0.1" ValueChanged="LoginPanelColorAdjustment_Changed"/>

                        <!-- Xem trước màu và mã Hex -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Rectangle Grid.Column="0" x:Name="rectLoginPanelColorPreview" Width="50" Height="25" Stroke="Black" StrokeThickness="1" Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" x:Name="txtLoginPanelBackgroundColorHex" VerticalContentAlignment="Center" LostFocus="HexColor_LostFocus" KeyDown="HexColor_KeyDown"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Tùy chỉnh Icon" Padding="10" Margin="0,15,0,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="btnSelectImage" Content="Chọn ảnh..." Width="120" HorizontalAlignment="Left" Click="BtnSelectImage_Click"/>
                            <Button x:Name="btnAddImageToLibrary" Content="Thêm vào thư viện" Width="120" Margin="10,0,0,0" Click="BtnAddImageToLibrary_Click" IsEnabled="False"/>
                        </StackPanel>
                        <TextBlock Text="Đường dẫn ảnh:" Margin="0,10,0,2" FontStyle="Italic"/>
                        <TextBlock x:Name="txtImagePath" Text="(Chưa chọn ảnh nào)" TextWrapping="Wrap" Background="#f0f0f0" Padding="2"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Chọn từ ảnh đã lưu" Padding="10" Margin="0,15,0,0">
                    <ListView x:Name="lvSavedImages" Height="100" SelectionChanged="LvSavedImages_SelectionChanged">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="Gray" BorderThickness="1" Margin="3" CornerRadius="3">
                                    <StackPanel Orientation="Vertical" Width="80" ToolTip="{Binding ImageName}">
                                        <Image Source="{Binding Thumbnail}" Width="70" Height="70" Stretch="Uniform" Margin="5"/>
                                        <TextBlock Text="{Binding ImageName}" TextTrimming="CharacterEllipsis" HorizontalAlignment="Center" FontSize="10"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </GroupBox>


                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,30,0,0">
                    <Button x:Name="btnSave" Content="Lưu cài đặt" Width="120" Height="35" Margin="5" Background="#28A745" Foreground="White" Click="BtnSave_Click"/>
                    <Button x:Name="btnReset" Content="Đặt lại mặc định" Width="120" Height="35" Margin="5" Background="#DC3545" Foreground="White" Click="BtnReset_Click"/>
                </StackPanel>
            </StackPanel>
        </Viewbox>

        <!-- Cột phải: Xem trước -->
        <Grid Grid.Column="1">
            <GroupBox x:Name="previewGroupBox" Header="Xem trước" Padding="10">
                <!-- Đặt kích thước cố định cho phần xem trước để có tỷ lệ giống màn hình đăng nhập thật -->
                <Border Background="#F5EFE6" CornerRadius="5" Width="490" Height="252" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <!-- Cột icon sẽ được điều chỉnh kích thước từ code -->
                            <ColumnDefinition x:Name="previewIconColumn" Width="2*"/> <!-- Luôn giữ tỷ lệ 40% -->
                            <ColumnDefinition Width="3*"/>
                        </Grid.ColumnDefinitions>

                        <Border x:Name="previewIconBorder" Grid.Column="0" Background="#D2B48C">
                            <Image x:Name="imgPreview" Source="pack://application:,,,/Resources/login_icon.png" 
                                   Stretch="Uniform" Margin="30"/>
                        </Border>

                        <!-- Form đăng nhập giả để minh họa -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="ĐĂNG NHẬP HỆ THỐNG" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                            <Rectangle Height="25" Width="200" Fill="WhiteSmoke" Margin="5"/>
                            <Rectangle Height="25" Width="200" Fill="WhiteSmoke" Margin="5"/>
                            <Rectangle Height="30" Width="150" Fill="Gainsboro" Margin="5,15,5,5"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </GroupBox>
        </Grid>
    </Grid>
</UserControl>